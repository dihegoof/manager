<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Invent√°rio da Casa</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body { margin: 0; background:#0b0f17; color:#e8eefc; }
    .wrap { max-width: 820px; margin: 0 auto; padding: 16px; }
    .card { background:#111829; border:1px solid #22304d; border-radius:16px; padding: 14px; }
    h1 { margin: 0 0 12px; font-size: 20px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    input, select, button {
      border-radius: 12px; border:1px solid #2b3a5f; background:#0f1626; color:#e8eefc;
      padding: 12px; font-size: 14px;
    }
    input { flex: 1; min-width: 180px; }
    select { min-width: 110px; }
    button { cursor:pointer; }
    .muted { color:#a9b5d2; font-size: 12px; margin-top: 8px; }
    .list { margin-top: 14px; display:flex; flex-direction:column; gap:10px; }
    .item { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .name { font-weight: 650; }
    .sub { color:#a9b5d2; font-size: 12px; }
    .controls { display:flex; align-items:center; gap:8px; }
    .qty { min-width: 70px; text-align:center; font-variant-numeric: tabular-nums; }
    .pill { padding:6px 10px; border-radius:999px; background:#0f203e; border:1px solid #2b3a5f; font-size:12px; color:#bcd3ff; }
    .danger { background:#2a1020; border-color:#6a2a4a; color:#ffb4d2; }
    .small { padding:8px 10px; font-size: 13px; }
    .divider { height: 1px; background:#22304d; margin: 12px 0; }
    @media (max-width: 480px) { .qty { min-width: 58px; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Invent√°rio da Casa</h1>

      <div class="row">
        <input id="search" placeholder="Buscar‚Ä¶ (ex: leite, arro, deterg)" />
      </div>

      <div class="divider"></div>

      <div class="row">
        <input id="name" placeholder="Novo item (ex: Leite)" />
        <select id="unit">
          <option value="un">un</option>
          <option value="g">g</option>
          <option value="kg">kg</option>
          <option value="ml">ml</option>
          <option value="l">l</option>
        </select>
        <input id="qty" type="number" step="0.1" placeholder="Qtd" style="max-width:120px;" />
        <input id="min" type="number" step="0.1" placeholder="M√≠n" style="max-width:120px;" />
        <button id="add">Adicionar</button>
      </div>

      <div class="muted">
        Dica: coloque ‚ÄúM√≠n‚Äù (m√≠nimo) pra aparecer como ‚Äúprecisa comprar‚Äù.
      </div>

      <div class="divider"></div>

      <div class="row">
        <button class="small" id="export">Exportar (backup)</button>
        <button class="small" id="import">Importar</button>
        <button class="small" id="clear">Zerar tudo</button>
      </div>

      <div class="list" id="list"></div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  // Normaliza texto pra buscar sem acento e sem ‚Äúdigitar perfeito‚Äù
  const norm = (s) =>
    (s || "")
      .toString()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .toLowerCase()
      .trim();

  // Armazenamento
  const KEY = "home_inventory_v1";

  function load() {
    try { return JSON.parse(localStorage.getItem(KEY)) || []; }
    catch { return []; }
  }

  function save(items) {
    localStorage.setItem(KEY, JSON.stringify(items));
  }

  let items = load();

  function render() {
    const q = norm($("search").value);
    const list = $("list");
    list.innerHTML = "";

    const filtered = items
      .filter(it => !q || it.name_norm.includes(q))
      .sort((a,b) => a.name.localeCompare(b.name, "pt-BR"));

    if (!filtered.length) {
      const empty = document.createElement("div");
      empty.className = "sub";
      empty.textContent = "Nada por aqui. Adicione itens acima üôÇ";
      list.appendChild(empty);
      return;
    }

    for (const it of filtered) {
      const row = document.createElement("div");
      row.className = "item";

      const left = document.createElement("div");
      const needs = (Number(it.min_qty) > 0 && Number(it.qty) <= Number(it.min_qty));
      left.innerHTML = `
        <div class="name">${it.name}</div>
        <div class="sub">
          ${it.qty} ${it.unit} ‚Ä¢ m√≠nimo: ${it.min_qty || 0}
          ${needs ? ' ‚Ä¢ <span class="pill danger">precisa comprar</span>' : ""}
        </div>
      `;

      const controls = document.createElement("div");
      controls.className = "controls";

      const minus = document.createElement("button");
      minus.textContent = "‚àí";
      minus.onclick = () => updateQty(it.id, -stepFor(it.unit));

      const qty = document.createElement("div");
      qty.className = "qty pill";
      qty.textContent = `${it.qty} ${it.unit}`;

      const plus = document.createElement("button");
      plus.textContent = "+";
      plus.onclick = () => updateQty(it.id, +stepFor(it.unit));

      const del = document.createElement("button");
      del.textContent = "üóëÔ∏è";
      del.title = "Remover";
      del.onclick = () => removeItem(it.id);

      controls.append(minus, qty, plus, del);
      row.append(left, controls);
      list.appendChild(row);
    }
  }

  function stepFor(unit) {
    // Ajuste de ‚Äútoque‚Äù r√°pido: unidade = 1, peso/volume = 0.1
    return unit === "un" ? 1 : 0.1;
  }

  function addItem() {
    const name = $("name").value.trim();
    const unit = $("unit").value;
    const qty = Number($("qty").value || 0);
    const minQty = Number($("min").value || 0);

    if (!name) return;

    // Se j√° existe item parecido, n√£o duplica: soma quantidade
    const n = norm(name);
    const existing = items.find(x => x.name_norm === n && x.unit === unit);

    if (existing) {
      existing.qty = round(existing.qty + qty);
      existing.min_qty = minQty || existing.min_qty || 0;
    } else {
      items.push({
        id: crypto.randomUUID(),
        name,
        name_norm: n,
        unit,
        qty: round(qty || 0),
        min_qty: round(minQty || 0)
      });
    }

    save(items);
    $("name").value = "";
    $("qty").value = "";
    $("min").value = "";
    render();
  }

  function round(v) {
    return Math.round((Number(v) + Number.EPSILON) * 10) / 10;
  }

  function updateQty(id, delta) {
    const it = items.find(x => x.id === id);
    if (!it) return;
    it.qty = round(Math.max(0, Number(it.qty) + Number(delta)));
    save(items);
    render();
  }

  function removeItem(id) {
    items = items.filter(x => x.id !== id);
    save(items);
    render();
  }

  $("add").onclick = addItem;
  $("search").addEventListener("input", render);
  $("name").addEventListener("keydown", (e) => { if (e.key === "Enter") addItem(); });

  // Export/Import
  $("export").onclick = () => {
    const blob = new Blob([JSON.stringify(items, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "inventario.json";
    a.click();
    URL.revokeObjectURL(url);
  };

  $("import").onclick = async () => {
    const inp = document.createElement("input");
    inp.type = "file";
    inp.accept = "application/json";
    inp.onchange = async () => {
      const file = inp.files?.[0];
      if (!file) return;
      const text = await file.text();
      const data = JSON.parse(text);
      if (!Array.isArray(data)) return;
      items = data;
      save(items);
      render();
    };
    inp.click();
  };

  $("clear").onclick = () => {
    if (!confirm("Tem certeza que quer zerar tudo?")) return;
    items = [];
    save(items);
    render();
  };

  render();
</script>
</body>
</html>
